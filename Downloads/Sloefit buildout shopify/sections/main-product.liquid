{%- liquid
  assign current_variant = product.selected_or_first_available_variant
  assign product_form_id = 'product-form-' | append: section.id
-%}

<div class="main-product color-{{ section.settings.color_scheme }} gradient">
  <div class="main-product__inner page-width">
    
    {%- comment -%} Breadcrumbs {%- endcomment -%}
    <nav class="main-product__breadcrumbs" aria-label="breadcrumb">
      <a href="{{ routes.root_url }}" class="main-product__breadcrumb-link">{{ 'general.breadcrumbs.home' | t }}</a>
      <span class="main-product__breadcrumb-separator">/</span>
      {%- if collection -%}
        <a href="{{ collection.url }}" class="main-product__breadcrumb-link">{{ collection.title }}</a>
        <span class="main-product__breadcrumb-separator">/</span>
      {%- endif -%}
      <span class="main-product__breadcrumb-current">{{ product.title }}</span>
    </nav>

    <div class="main-product__grid grid grid--1-col grid--2-col-desktop">
      
      {%- comment -%} Left Column: Product Image Gallery {%- endcomment -%}
      <div class="main-product__media">
        {%- if product.featured_media -%}
          <div class="main-product__image-wrapper">
            <img
              id="main-product-image"
              src="{{ product.featured_media | image_url: width: 800 }}"
              alt="{{ product.featured_media.alt | escape }}"
              class="main-product__image"
              loading="lazy"
              width="{{ product.featured_media.width }}"
              height="{{ product.featured_media.height }}"
            >
          </div>
          
          {%- if product.media.size > 1 -%}
            <div class="main-product__thumbnails">
              {%- for media in product.media limit: 4 -%}
                <button
                  type="button"
                  class="main-product__thumbnail{% if forloop.first %} main-product__thumbnail--active{% endif %}"
                  data-media-id="{{ media.id }}"
                  aria-label="{{ 'products.product.media.load_image' | t: index: forloop.index }}"
                >
                  {{ media | image_url: width: 200 | image_tag:
                    loading: 'lazy',
                    alt: media.alt | escape,
                    class: 'main-product__thumbnail-image'
                  }}
                </button>
              {%- endfor -%}
            </div>
          {%- endif -%}
        {%- else -%}
          <div class="main-product__image-wrapper">
            {{ 'product-1' | placeholder_svg_tag: 'main-product__placeholder' }}
          </div>
        {%- endif -%}
      </div>

      {%- comment -%} Right Column: Product Info {%- endcomment -%}
      <div class="main-product__info">
        <h1 class="main-product__title">{{ product.title | escape }}</h1>
        
        {%- if product.description != blank -%}
          <div class="main-product__description">
            {{ product.description }}
          </div>
        {%- endif -%}
        
        <div class="main-product__price">
          {% render 'price', product: product, use_variant: true, show_badges: false %}
        </div>

        {%- comment -%} Bullet Points (Key Benefits) {%- endcomment -%}
        {%- if section.settings.show_bullet_points and section.settings.bullet_points != blank -%}
          <ul class="main-product__benefits">
            {%- assign bullets = section.settings.bullet_points | newline_to_br | split: '<br />' -%}
            {%- for bullet in bullets -%}
              {%- if bullet != blank -%}
                <li class="main-product__benefit">
                  {% render 'icon-check-circle' %}
                  <span>{{ bullet | strip }}</span>
                </li>
              {%- endif -%}
            {%- endfor -%}
          </ul>
        {%- endif -%}

        {%- form 'product', product, id: product_form_id, class: 'form', novalidate: 'novalidate' -%}
          {%- unless product.has_only_default_variant -%}
            <div class="main-product__variants">
              {%- for option in product.options_with_values -%}
                <div class="main-product__variant-selector">
                  <label class="main-product__variant-label" for="Option-{{ section.id }}-{{ forloop.index0 }}">
                    {{ option.name }}
                  </label>
                  <select
                    id="Option-{{ section.id }}-{{ forloop.index0 }}"
                    name="options[{{ option.name | escape }}]"
                    form="{{ product_form_id }}"
                    class="main-product__variant-select"
                  >
                    {%- for value in option.values -%}
                      <option value="{{ value | escape }}" {% if option.selected_value == value %}selected="selected"{% endif %}>
                        {{ value }}
                      </option>
                    {%- endfor -%}
                  </select>
                </div>
              {%- endfor -%}
            </div>
          {%- endunless -%}

          <input type="hidden" name="id" value="{{ current_variant.id }}" disabled>

          {%- comment -%} Quantity Selector {%- endcomment -%}
          <div class="main-product__quantity">
            <label for="Quantity-{{ section.id }}" class="main-product__quantity-label">
              {{ 'products.product.quantity.label' | t }}
            </label>
            <div class="main-product__quantity-controls">
              <button
                type="button"
                class="main-product__quantity-button"
                id="qty-minus-{{ section.id }}"
                aria-label="{{ 'products.product.quantity.decrease' | t: product: product.title | escape }}"
              >
                {% render 'icon-minus' %}
              </button>
              <input
                type="number"
                id="Quantity-{{ section.id }}"
                name="quantity"
                class="main-product__quantity-input"
                value="1"
                min="1"
                form="{{ product_form_id }}"
              >
              <button
                type="button"
                class="main-product__quantity-button"
                id="qty-plus-{{ section.id }}"
                aria-label="{{ 'products.product.quantity.increase' | t: product: product.title | escape }}"
              >
                {% render 'icon-plus' %}
              </button>
            </div>
          </div>

          {%- comment -%} Add to Cart Button {%- endcomment -%}
          <button
            type="submit"
            name="add"
            class="main-product__submit button button--primary"
            {% if product.selected_or_first_available_variant.available == false %}disabled{% endif %}
          >
            {%- if product.selected_or_first_available_variant.available -%}
              {{ 'products.product.add_to_cart' | t }}
            {%- else -%}
              {{ 'products.product.sold_out' | t }}
            {%- endif -%}
          </button>
        {%- endform -%}
      </div>
    </div>
  </div>
</div>

{% style %}
  .main-product {
    padding: 3rem 1rem;
  }
  @media screen and (min-width: 750px) {
    .main-product {
      padding: 6rem 1rem;
    }
  }
  .main-product__inner {
    max-width: 75rem;
    margin: 0 auto;
  }
  .main-product__breadcrumbs {
    font-size: 0.875rem;
    color: var(--color-base-text);
    opacity: 0.6;
    margin-bottom: 1.5rem;
  }
  .main-product__breadcrumb-link {
    color: inherit;
    transition: opacity 0.2s;
  }
  .main-product__breadcrumb-link:hover {
    opacity: 1;
  }
  .main-product__breadcrumb-separator {
    margin: 0 0.5rem;
  }
  .main-product__breadcrumb-current {
    opacity: 1;
  }
  .main-product__grid {
    gap: 2rem;
  }
  @media screen and (min-width: 750px) {
    .main-product__grid {
      gap: 4rem;
    }
  }
  .main-product__image-wrapper {
    width: 100%;
    aspect-ratio: 1;
    border-radius: 1rem;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
  }
  .main-product__image,
  .main-product__placeholder {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  .main-product__thumbnails {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-top: 1rem;
  }
  .main-product__thumbnail {
    width: 100%;
    aspect-ratio: 1;
    border-radius: 0.75rem;
    overflow: hidden;
    border: 2px solid transparent;
    background: none;
    padding: 0;
    cursor: pointer;
    transition: border-color 0.2s;
  }
  .main-product__thumbnail:hover {
    border-color: var(--color-base-text);
    opacity: 0.6;
  }
  .main-product__thumbnail--active {
    border-color: var(--color-primary);
  }
  .main-product__thumbnail-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  .main-product__title {
    font-size: 1.875rem;
    font-weight: 900;
    color: var(--color-base-text);
    text-transform: uppercase;
    margin: 0;
  }
  @media screen and (min-width: 750px) {
    .main-product__title {
      font-size: 2.25rem;
    }
  }
  .main-product__description {
    font-size: 1.125rem;
    color: var(--color-base-text);
    opacity: 0.88;
    margin-top: 1rem;
    line-height: 1.6;
  }
  .main-product__price {
    font-size: 2.25rem;
    font-weight: 700;
    color: var(--color-base-text);
    margin-top: 1.5rem;
  }
  .main-product__benefits {
    list-style: none;
    padding: 0;
    margin: 1.5rem 0 0;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  .main-product__benefit {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--color-base-text);
    opacity: 0.88;
  }
  .main-product__benefit svg {
    width: 1.25rem;
    height: 1.25rem;
    color: var(--color-primary);
    flex-shrink: 0;
  }
  .main-product__variants {
    margin-top: 2rem;
  }
  .main-product__variant-selector {
    margin-bottom: 1rem;
  }
  .main-product__variant-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: uppercase;
    color: var(--color-base-text);
    margin-bottom: 0.5rem;
  }
  .main-product__variant-select {
    width: 100%;
    background-color: var(--color-base-background-2);
    color: var(--color-base-text);
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    border: 1px solid var(--color-base-background-2);
    font-size: 1rem;
    transition: border-color 0.2s;
  }
  .main-product__variant-select:focus {
    outline: none;
    border-color: var(--color-primary);
  }
  .main-product__quantity {
    margin-top: 2rem;
  }
  .main-product__quantity-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: uppercase;
    color: var(--color-base-text);
    margin-bottom: 0.5rem;
  }
  .main-product__quantity-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    max-width: 150px;
  }
  .main-product__quantity-button {
    background-color: var(--color-base-background-2);
    color: var(--color-base-text);
    opacity: 0.6;
    padding: 0.75rem;
    border-radius: 0.5rem;
    border: none;
    cursor: pointer;
    transition: opacity 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .main-product__quantity-button:hover {
    opacity: 1;
  }
  .main-product__quantity-input {
    flex: 1;
    text-align: center;
    background-color: var(--color-base-background-2);
    color: var(--color-base-text);
    font-weight: 700;
    font-size: 1.125rem;
    padding: 0.5rem;
    border-radius: 0.5rem;
    border: 1px solid var(--color-base-background-2);
    -moz-appearance: textfield;
  }
  .main-product__quantity-input::-webkit-inner-spin-button,
  .main-product__quantity-input::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  .main-product__quantity-input:focus {
    outline: none;
    border-color: var(--color-primary);
  }
  .main-product__submit {
    width: 100%;
    margin-top: 2rem;
    padding: 1rem 2rem;
    font-size: 1.125rem;
  }
  .main-product__submit:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
{% endstyle %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sectionId = '{{ section.id }}';
    const qtyMinus = document.getElementById('qty-minus-' + sectionId);
    const qtyPlus = document.getElementById('qty-plus-' + sectionId);
    const qtyInput = document.getElementById('Quantity-' + sectionId);
    const thumbnails = document.querySelectorAll('.main-product__thumbnail');
    const mainImage = document.getElementById('main-product-image');

    // Quantity controls
    if (qtyMinus && qtyPlus && qtyInput) {
      qtyMinus.addEventListener('click', () => {
        let currentValue = parseInt(qtyInput.value, 10);
        if (currentValue > 1) {
          qtyInput.value = currentValue - 1;
        }
      });

      qtyPlus.addEventListener('click', () => {
        let currentValue = parseInt(qtyInput.value, 10);
        qtyInput.value = currentValue + 1;
      });
    }

    // Image gallery
    if (thumbnails.length > 0 && mainImage) {
      thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
          const img = this.querySelector('img');
          if (img) {
            mainImage.src = img.src.replace(/width=\d+/, 'width=800');
            thumbnails.forEach(t => t.classList.remove('main-product__thumbnail--active'));
            this.classList.add('main-product__thumbnail--active');
          }
        });
      });
    }
  });
</script>

{% schema %}
{
  "name": "Main Product",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_bullet_points",
      "default": true,
      "label": "Show Bullet Points",
      "info": "Display key benefits as bullet points"
    },
    {
      "type": "textarea",
      "id": "bullet_points",
      "default": "25g Protein Per Serving\nTransparently Sourced\nZero Added Sugar\nMixes Instantly",
      "label": "Bullet Points",
      "info": "Enter one benefit per line"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "options": [
        {
          "value": "accent-1",
          "label": "Accent 1"
        },
        {
          "value": "accent-2",
          "label": "Accent 2"
        },
        {
          "value": "background-1",
          "label": "Background 1"
        },
        {
          "value": "background-2",
          "label": "Background 2"
        },
        {
          "value": "inverse",
          "label": "Inverse"
        }
      ],
      "default": "background-1",
      "label": "Color Scheme"
    }
  ],
  "presets": [
    {
      "name": "Main Product"
    }
  ]
}
{% endschema %}

